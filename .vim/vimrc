" Shortcut to open vimrc
nmap <silent><Leader>v :e ~/.vim/vimrc<CR>

" Shortcut to open workingMemory
nmap <silent><Leader>wm :e ~/workingMemory.txt<CR>

" Stolen from garybernhardt/dotfiles/.vimrc
""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" MULTIPURPOSE TAB KEY
" Indent if we're at the beginning of a line. Else, do completion.
""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
function! InsertTabWrapper()
    let col = col('.') - 1
    if !col
        return "\<tab>"
    endif

    let char = getline('.')[col - 1]
    if char =~ '\k'
        " There's an identifier before the cursor, so complete the identifier.
        return "\<c-p>"
    else
        return "\<tab>"
    endif
endfunction
inoremap <expr> <tab> InsertTabWrapper()
inoremap <s-tab> <c-n>

" 1. Filetype detection.
" 2. Using filetype plugin files
" 3. Using indent files
filetype plugin indent on


" Disable automatically adding comments to the next line
autocmd FileType * set formatoptions-=c formatoptions-=r formatoptions-=o
" Allow recursive find
set path+=**

" Allows %% in command mode to fill in the directory of the buffer
cnoremap <expr> %% getcmdtype() == ':' ? expand('%:h').'/' : '%%'

" Unbind some useless/annoying default key bindings.
nmap Q <Nop> " 'Q' in normal mode enters Ex mode. You almost never want this.

" No large banner at the top of netwr
let g:netrw_banner=0
" Adds command DiffOrig to compare changes in buffer
" command DiffOrig vert new | set bt=nofile | r ++edit # | 0d_ | diffthis
      "\ | wincmd p | diffthis
" Try to prevent bad habits like using the arrow keys for movement. This is
" not the only possible bad habit. For example, holding down the h/j/k/l keys
" for movement, rather than using more efficient movement commands, is also a
" bad habit. The former is enforceable through a .vimrc, while we don't know
" how to prevent the latter.
" Do this in normal mode...
nnoremap <Left>  :echoe "Use h"<CR>
nnoremap <Right> :echoe "Use l"<CR>
nnoremap <Up>    :echoe "Use k"<CR>
nnoremap <Down>  :echoe "Use j"<CR>
" ...and in insert mode
inoremap <Left>  <ESC>:echoe "Use h"<CR>
inoremap <Right> <ESC>:echoe "Use l"<CR>
inoremap <Up>    <ESC>:echoe "Use k"<CR>
inoremap <Down>  <ESC>:echoe "Use j"<CR>
set ts=4 sw=4

" git conflict marker shortcuts
" conflict marker
nmap <silent><Leader>< /<<<<<<<<CR>
" conflict marker
nmap <silent><Leader>> />>>>>>><CR>
" conflict marker
nmap <silent><Leader>= /=======<CR>

" Install Vim Plug if needed
let data_dir = has('nvim') ? stdpath('data') . '/site' : '~/.vim'
if empty(glob(data_dir . '/autoload/plug.vim'))
  silent execute '!curl -fLo '.data_dir.'/autoload/plug.vim --create-dirs  https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim'
  autocmd VimEnter * PlugInstall --sync | source $MYVIMRC
endif

call plug#begin()
Plug 'joshdick/onedark.vim'
Plug 'morhetz/gruvbox'

" Deletes trailing whitespace on buffer write
Plug 'ntpeters/vim-better-whitespace'
let g:better_whitespace_enabled=0
let g:strip_whitespace_on_save=1
let g:strip_whitespace_confirm=0

" Allows changing the surrounding chars of a string with cs
Plug 'tpope/vim-surround'

" Allows for easy commenting out of lines and motions
Plug 'tpope/vim-commentary'

" Allows . command to repeat plugin actions
Plug 'tpope/vim-repeat'

" Shortcuts for navigating quickfix list
nnoremap <silent> ]q :cnext<CR>
nnoremap <silent> [q :cprev<CR>

" Shortcuts to navigate the buffer list
nnoremap <silent> ]b :bnext<CR>
nnoremap <silent> [b :bprev<CR>
nnoremap <silent> [a :e #<CR>

" Fuzzy file finder
Plug 'junegunn/fzf', { 'do': { -> fzf#install() } }
Plug 'junegunn/fzf.vim'

" Git integration
Plug 'tpope/vim-fugitive'
" Open diffs in vertical splits by default
if &diff
    set diffopt-=internal
    set diffopt+=vertical
endif
" Remap GFiles to ctrl P
nnoremap <C-p> :<C-u>:GFiles<CR>

" Grep within working dir or repo
Plug 'mhinz/vim-grepper'
let g:grepper = {}
let g:grepper.tools = ['rg', 'git', 'grep']
" Use gs to take any motion and populate the search prompt
nmap gs  <plug>(GrepperOperator)
xmap gs  <plug>(GrepperOperator)
" Shortcut to open :Grepper
nmap <silent><Leader>gg :Grepper<CR>

Plug 'heavenshell/vim-jsdoc', {
  \ 'for': ['javascript', 'javascriptreact', 'typescript', 'typescriptreact'],
  \ 'do': 'make install'
\}

if has('nvim')
    " figure out how to do a conditional the other way
else
    " vim settings that we don't want to use for neovim
    Plug 'pangloss/vim-javascript'
    Plug 'leafgarland/typescript-vim'
    Plug 'kchmck/vim-coffee-script'
    Plug 'maxmellon/vim-jsx-pretty'
    " Plug 'mxw/vim-jsx'

    " Asynchronous Lint Engine - linting and type checks
    Plug 'dense-analysis/ale'
    " ALE options
    let g:ale_linters = {'javascript': ['eslint'], 'typescript': ['tsserver', 'eslint'], 'typescript.tsx': ['tsserver', 'eslint'], 'coffee': ['coffeelint']}
    let g:ale_fixers = {'javascript': ['eslint'], 'typescript': ['prettier'], 'typescript.tsx': ['prettier']}
    let g:ale_open_list = 0
    let g:ale_lint_on_text_changed = 'normal'
    let g:ale_lint_on_insert_leave = 1
    let g:ale_lint_delay = 0
    let g:ale_set_quickfix = 0
    let g:ale_set_loclist = 1
    let g:ale_hover_cursor = 1
    let g:ale_floating_preview = 1
    let g:ale_set_balloons = 1
    let g:ale_floating_window_border = []
    let g:ale_sign_column_always = 1
    let g:ale_cursor_detail = 0
    let g:ale_hover_to_floating_preview = 1
    let g:ale_detail_to_floating_preview = 1
    " Mappings from Modern Vim to move through warnings/errors
    nmap <silent> [W <Plug>(ale_first)
    nmap <silent> [w <Plug>(ale_previous)
    nmap <silent> ]w <Plug>(ale_next)
    nmap <silent> ]W <Plug>(ale_last)
    " Mappings for other ALE commands
    nmap gd <Plug>(ale_go_to_definition)
    nmap gr <Plug>(ale_find_references)
    nmap <Leader>d <Plug>(ale_detail)
    nmap <Leader>h <Plug>(ale_hover)
    nmap <Leader>r <Plug>(ale_rename)

endif

call plug#end()
" colorscheme onedark
colorscheme gruvbox
